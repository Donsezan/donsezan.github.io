<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Prompt Optimizer</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #0d1117;
        color: #c9d1d9;
        display: flex;
        height: 100vh;
        overflow: hidden;
    }

    /* --- History Panel --- */
    #history {
        width: 260px;
        background: #161b22;
        border-right: 1px solid #30363d;
        overflow-y: auto;
        padding: 10px;
    }
    #history h3 {
        margin-top: 0;
        color: #58a6ff;
    }
    .history-item {
        background: #21262d;
        padding: 8px;
        border-radius: 6px;
        margin-bottom: 8px;
        cursor: pointer;
        border: 1px solid #30363d;
        font-size: 13px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .history-item:hover {
        background: #30363d;
    }

    /* --- Main Container --- */
    #main {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 20px;
    }

    textarea {
        width: 100%;
        background: #161b22;
        border: 1px solid #30363d;
        border-radius: 6px;
        color: #c9d1d9;
        padding: 10px;
        font-size: 14px;
        resize: vertical;
        min-height: 150px;
    }

    #stats {
        margin: 10px 0;
        padding: 10px;
        border-radius: 6px;
        background: #161b22;
        border: 1px solid #30363d;
        font-size: 14px;
    }

    button {
        background: #238636;
        border: none;
        padding: 10px 16px;
        border-radius: 6px;
        color: white;
        cursor: pointer;
        margin-right: 6px;
        margin-bottom: 10px;
    }
    button:hover {
        background: #2ea043;
    }

    #helpBtn {
        background: #1f6feb;
    }
    #helpBtn:hover {
        background: #388bfd;
    }

    #codeBtn {
        background: #8957e5;
    }
    #codeBtn:hover {
        background: #9e77f5;
    }

    /* --- Help Modal --- */
    #helpModal {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.7);
        justify-content: center;
        align-items: center;
    }
    #helpContent {
        background: #161b22;
        border: 1px solid #30363d;
        padding: 20px;
        width: 420px;
        border-radius: 10px;
    }
    #closeHelp {
        margin-top: 10px;
        background: #da3633;
    }
    #closeHelp:hover {
        background: #f85149;
    }
</style>
</head>
<body>

<!-- HISTORY PANEL -->
<div id="history">
    <h3>History</h3>
    <div id="historyList"></div>
</div>

<!-- MAIN PANEL -->
<div id="main">
    <textarea id="input" placeholder="Enter your prompt..."></textarea>
    <div id="stats">No input yet.</div>

    <textarea id="output" placeholder="Optimized result..."></textarea>
    <div style="margin-top: 10px;">
        <button onclick="optimizeLLM()">Optimize (LLM)</button>
        <button id="codeBtn" onclick="optimizeCode()">Optimize (Code)</button>
        <button onclick="clearInput()">Clear Input</button>
        <button onclick="copyResult()">Copy Result</button>
        <button id="helpBtn" onclick="openHelp()">Help</button>
    </div>

</div>

<!-- HELP MODAL -->
<div id="helpModal">
    <div id="helpContent">
        <h3>What This Page Does</h3>
        <p>This tool compresses your prompts to fit LLM character limits.</p>
        <ul>
            <li><b>Optimize (LLM)</b>: removes redundant spaces, symbols, and formatting while preserving meaning.</li>
            <li><b>Optimize (Code)</b>: strips tabs, collapses whitespace, removes spaces around braces, parentheses, etc.</li>
            <li><b>History</b>: shows past inputs for this session.</li>
        </ul>
        <button id="closeHelp" onclick="closeHelp()">Close</button>
    </div>
</div>

<script>
/* --- History ------------------------------------------------------------- */
function addToHistory(text) {
    if (!text.trim()) return;

    const item = document.createElement('div');
    item.className = 'history-item';
    item.textContent = text.slice(0, 120);

    item.onclick = () => {
        document.getElementById("input").value = text;
    };

    document.getElementById("historyList").prepend(item);
}

/* --- LLM Optimization ----------------------------------------------------- */
function optimizeLLM() {
    let text = document.getElementById("input").value;

    addToHistory(text);

    let original = text.length;

    // Remove tabs, multiple spaces, trim lines
    text = text.replace(/\s+/g, " ").trim();

    // Remove soft punctuation that doesn't affect meaning
    text = text.replace(/[•·►|]/g, "");

    let result = text;
    let finalLen = result.length;

    document.getElementById("output").value = result;
    updateStats(original, finalLen);
}

/* --- Code Optimization ---------------------------------------------------- */
function optimizeCode() {
    let text = document.getElementById("input").value;

    addToHistory(text);

    let original = text.length;

    // Remove tabs
    text = text.replace(/\t+/g, "");

    // Remove spaces around braces and parentheses: { } ( ) [ ]
    text = text.replace(/\s*([{}()\[\]])\s*/g, "$1");

    // Remove spaces around operators: = + - * / : ;
    text = text.replace(/\s*([=+\-*\/:;,])\s*/g, "$1");

    // Collapse multiple spaces
    text = text.replace(/ +/g, " ");

    // Remove empty lines
    text = text.replace(/^\s*[\r\n]/gm, "");

    let result = text.trim();
    let finalLen = result.length;

    document.getElementById("output").value = result;
    updateStats(original, finalLen);
}

/* --- Stats --------------------------------------------------------------- */
function updateStats(original, finalVal) {
    const removed = original - finalVal;
    document.getElementById("stats").innerHTML = `
        Original: <b>${original}</b> chars | Removed: <b>${removed}</b> | Final: <b>${finalVal}</b> chars
    `;
}

/* --- Utility Buttons ----------------------------------------------------- */
function clearInput() {
    document.getElementById("input").value = "";
}

function copyResult() {
    const text = document.getElementById("output");
    text.select();
    document.execCommand("copy");
}

/* --- Help Modal ---------------------------------------------------------- */
function openHelp() {
    document.getElementById("helpModal").style.display = "flex";
}
function closeHelp() {
    document.getElementById("helpModal").style.display = "none";
}
</script>
</body>
</html>
